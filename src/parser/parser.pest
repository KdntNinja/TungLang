// The main rule that defines a `.tung` file.
// A file consists of zero or more statements, each optionally followed by a newline, and ends with EOI (End of Input).
file = { SOI ~ NEWLINE* ~ (statement ~ NEWLINE*)* ~ EOI }

// Comments are allowed anywhere and should be skipped
COMMENT = _{ "#" ~ (!NEWLINE ~ ANY)* ~ (NEWLINE | EOI) }

// A statement can be a declaration, assignment, function call, or control structure.
statement = { variable_declaration | assignment | function_call | if_statement }

// Variable declaration with var keyword or its aliases
variable_declaration = { var_keyword ~ identifier ~ "=" ~ expression }

// Var keyword and its aliases
var_keyword = { "var" }

// Assignment to existing variable with expression as value
assignment = { identifier ~ "=" ~ expression }

// Function call with optional arguments
function_call = { identifier ~ "(" ~ (expression ~ ("," ~ expression)*)? ~ ")" }

// If statement - handling control keywords dynamically in the interpreter
if_statement = { 
    control_keyword ~ ("(" ~ expression ~ ")" | expression) ~ ":" ~ NEWLINE+ ~
    (statement ~ NEWLINE*)* ~
    end_control_keyword
}

// Control keywords
control_keyword = { "if" | "la_vaca" }
end_control_keyword = { "endif" | "fine_vaca" }

// Expression
expression = { comparison | term }

// Comparison expression - revised to ensure proper parsing
comparison = { term ~ comparison_op ~ term }

// Term
term = { factor ~ (operator ~ factor)* }

// Factor
factor = { value | identifier | "(" ~ expression ~ ")" }

// Arithmetic operators
operator = { "+" | "-" | "*" | "/" }
// Fix the rule to make comparison operators distinct tokens
comparison_op = @{ "==" | "!=" | "<=" | ">=" | "<" | ">" }

// Identifiers
identifier = @{ (ASCII_ALPHA | "_") ~ (ASCII_ALPHANUMERIC | "_")* }

// Values
value = { number | string_literal | boolean }

// Numbers
number = { ASCII_DIGIT+ }

// String literals
string_literal = { "\"" ~ string_content ~ "\"" }
string_content = { (!("\"") ~ ANY)* }

// Boolean values
boolean = { "true" | "false" }

// Silent whitespace
WHITESPACE = _{ " " | "\t" }

// Newlines
NEWLINE = _{ "\r\n" | "\n" | "\r" }
